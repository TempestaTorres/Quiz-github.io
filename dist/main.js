(()=>{"use strict";class t{constructor(t){if(this.emailRegExp=/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/,this.nameRegExp=/^[A-Z][a-zA-Z]+\s*$/,this.valid=!1,this.form=document.querySelector(t),this.form&&(this.inputs=this.form.querySelectorAll("input")),this.inputs){for(let t=0;t<this.inputs.length;t++){const e=this.inputs[t];"checkbox"!==e.type?e.addEventListener("input",this.#t.bind(this)):e.addEventListener("click",this.#e.bind(this))}this.form.addEventListener("submit",this.#s.bind(this))}}#s(t){if(t.preventDefault(),this.form.checkValidity()&&this.valid){let t={firstname:"",lastname:"",email:""};for(let e=0;e<this.inputs.length;e++){const s=this.inputs[e];"firstname"===s.name&&(t.firstname=s.value.trim()),"lastname"===s.name&&(t.lastname=s.value.trim()),"email"===s.type&&(t.email=s.value.trim())}this.form.reset(),location.href="#/select?firstname="+t.firstname+"&lastname="+t.lastname+"&email="+t.email}}#t(t){switch(t.target.name){case"firstname":case"lastname":this.#i(t.target);break;case"email":this.#n(t.target)}}#a(t){return t.value.length>1&&this.nameRegExp.test(t.value)}#i(t){this.valid=this.#a(t),this.valid?(t.nextElementSibling.nextElementSibling.textContent="",t.setCustomValidity("")):t.value.length<2?t.nextElementSibling.nextElementSibling.textContent="Name must be at least 2 characters long":(t.nextElementSibling.nextElementSibling.textContent="First letter is capital",t.setCustomValidity("invalid"))}#n(t){this.valid=this.#l(t),this.valid?(t.nextElementSibling.nextElementSibling.textContent="",t.setCustomValidity("")):(t.nextElementSibling.nextElementSibling.textContent="Please enter a valid email address",t.setCustomValidity("invalid"))}#l(t){return t.value.length>6&&this.emailRegExp.test(t.value)}#e(t){this.valid=t.target.checked,this.valid?(t.target.parentElement.nextElementSibling.textContent="",t.target.setCustomValidity("")):(t.target.parentElement.nextElementSibling.textContent="Please check the box",t.target.setCustomValidity("invalid"))}}function e(){let t=s();return!!t.firstname||!!t.lastName||!!t.email}function s(){const t=document.location.hash.split("+").join(" ");let e,s={},i=/[?&]([^=]+)=([^&]*)/g;for(;e=i.exec(t);)s[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return s}function i(t,e){t.nextElementSibling.textContent=e,t.nextElementSibling.classList.toggle("is-active"),setTimeout(()=>{t.nextElementSibling.classList.toggle("is-active")},1e3)}class n{constructor(){e()?this.#r():location.href="#/"}#r(){let t=new XMLHttpRequest;t.open("GET","https://testologia.ru/get-quizzes",!1),t.send(),4===t.readyState&&200===t.status?this.#o(JSON.parse(t.responseText)):location.href="#/"}#d(t){if("test-button"===t.target.parentElement.dataset.nodeType){t.preventDefault();let e=t.target.parentElement.dataset.nodeData,i=s();location.href="#/test?firstname="+i.firstname+"&lastname="+i.lastname+"&email="+i.email+"&id="+e,t.stopPropagation()}}#o(t){const e=document.querySelector(".test-selection");if(t&&t.length>0){for(const s of t)this.#u(e,s);e.addEventListener("click",this.#d)}}#u(t,e){let{id:s,name:i}=e,n=document.createElement("div");n.classList.add("select-wrapper"),n.dataset.nodeType="test",n.dataset.nodeIndex=`${s}`;let a=document.createElement("p");a.classList.add("text-size-small","font-600","transition-color-300"),a.textContent=i;let l=document.createElement("a");l.classList.add("arrow-button"),l.href=`test${s}.html`,l.role="button",l.dataset.nodeType="test-button",l.dataset.nodeData=`${s}`;let r=document.createElement("img");r.classList.add("svg"),r.src="./dist/assets/img/arrow-right-thin.svg",r.loading="lazy",r.alt="",l.appendChild(r),n.appendChild(a),n.appendChild(l),t.appendChild(n)}}class a{constructor(){this.test=null,e()||(location.href="#/");let t=s();this.testId=t.id,isNaN(this.testId)&&(location.href="#/"),this.userResult=[],this.timer={timerId:0,seconds:60},this.timerCounter=document.querySelector(".timer-counter"),this.#r()}#r(){let t=new XMLHttpRequest;if(t.open("GET",`https://testologia.ru/get-quiz?id=${this.testId}`,!1),t.send(),4===t.readyState&&200===t.status)try{this.test=JSON.parse(t.responseText),this.#c(),this.#h(),this.#m(0),this.#p()}catch(t){location.href="#/"}else location.href="#/"}#c(){let t=document.querySelector(".test-caption");t.textContent=this.test.name,t.ariaLabel=`test ${this.test.id}`}#h(){let t=document.querySelector(".test-progress-bar-wrapper");t.firstElementChild.dataset.ariaLabel="mad jun progressbar";for(let e=0;e<this.test.questions.length;e++){let s=document.createElement("div");s.classList.add("progress-bar-item","flex","items-center"),s.dataset.nodeIndex=`${e}`,0===e&&s.classList.add("is-next");let i=document.createElement("div");if(i.classList.add("progress-bar-circle","rounded-full"),s.appendChild(i),e<this.test.questions.length-1){let t=document.createElement("div");t.classList.add("progress-bar-line","transition-400"),s.appendChild(t)}t.firstElementChild.appendChild(s);let n=document.createElement("div");n.classList.add("text-size-progress-bar"),n.textContent=`Вопрос ${e+1}`,t.lastElementChild.appendChild(n)}}#m(t){let e=this.test.questions[t],s=document.querySelector(".question-title");s.dataset.nodeId=`${t+1}`,s.firstElementChild.dataset.nodeId=`${e.id}`;let i=document.createElement("span");i.classList.add("text-primary"),i.textContent=e.question,s.firstElementChild.textContent=`Вопрос ${t+1}: `,s.firstElementChild.appendChild(i),this.#g(e.answers)}#g(t){let e=document.querySelector(".options-wrapper");for(let s=0;s<t.length;++s){let i=t[s],n=document.createElement("label");n.classList.add("radio-button-container","text-size-medium"),n.textContent=i.answer;let a=document.createElement("input");a.classList.add("radio-button-input"),a.type="radio",a.name="radio",a.value=`${i.id}`,a.id=`answer-${s+1}`;let l=document.createElement("span");l.classList.add("radio-button-checkmark"),n.appendChild(a),n.appendChild(l),e.appendChild(n)}}#p(){this.timerCounter.textContent=`${this.timer.seconds}`,document.querySelectorAll(".app-button.next").forEach(t=>{t.dataset.nodeIndex="1",t.dataset.maxNodes=`${this.test.questions.length}`,t.addEventListener("click",this.#f.bind(this))});let t=document.querySelector(".omit-question");t.dataset.nodeIndex="1",t.dataset.maxNodes=`${this.test.questions.length}`,t.addEventListener("click",this.#x.bind(this)),this.timer.timerId=setInterval(this.#S.bind(this),1e3)}#S(){this.timer.seconds<10?this.timerCounter.textContent=`0${this.timer.seconds}`:this.timerCounter.textContent=`${this.timer.seconds}`,--this.timer.seconds<0&&this.#y(!1)}#v(){let t=s(),e=JSON.stringify({name:t.firstname,lastName:t.lastname,email:t.email,results:this.userResult}),i=new XMLHttpRequest;if(i.open("POST",`https://testologia.ru/pass-quiz?id=${this.test.id}`,!1),i.setRequestHeader("Content-Type","application/json;charset=utf-8"),i.send(e),4===i.readyState&&200===i.status)try{let e=JSON.parse(i.responseText);location.href=`#/result?id=${this.test.id}&score=`+e.score+"&total="+e.total,sessionStorage.setItem("madJunUser",JSON.stringify({name:t.firstname,lastName:t.lastname,email:t.email,results:this.userResult}))}catch(t){console.error(t),location.href="#/"}}#f(t){t.preventDefault();let e=parseInt(t.target.dataset.nodeIndex),s=parseInt(t.target.dataset.maxNodes);if("button-prev"===t.target.dataset.nodeType)1===e?i(t.target,"Oops... :)"):(this.#C(e-2),this.#b());else if("button-next"===t.target.dataset.nodeType){if(e>s)return void this.#v();if(this.#w()&&0!==this.timer.timerId){let n={questionId:0,chosenAnswerId:0};n.questionId=this.#I(),n.chosenAnswerId=this.#E(),this.#q(n);let a=this.#L();this.#k(a),e===s&&this.#R()?(t.target.textContent="Проверить",t.target.dataset.nodeIndex=`${e+1}`,this.#y(!0)):e!==s||this.#R()?e<s&&(this.#C(a+1),this.#b()):i(t.target,"Oops... :)")}else i(t.target,"Oops... :)")}}#x(t){if(t.preventDefault(),this.#w())i(t.target,"Oops... :)");else{let e=parseInt(t.target.dataset.nodeIndex);e<parseInt(t.target.dataset.maxNodes)?this.#C(e):i(t.target,"Oops... :)")}}#C(t){this.#N(t),this.#T(),this.#m(t),this.#$(t+1),this.#A(t+1)}#A(t){document.querySelector(".omit-question").dataset.nodeIndex=`${t}`}#$(t){let e=document.querySelectorAll(".app-button.next");e[0].dataset.nodeIndex=`${t}`,e[1].dataset.nodeIndex=`${t}`}#T(){let t=document.querySelectorAll(".radio-button-container");for(let e=0;e<t.length;++e)t[e].remove()}#N(t){let e=document.querySelector(".test-progress-bar");for(let t=0;t<e.children.length;++t)e.children[t].classList.contains("is-next")&&e.children[t].classList.remove("is-next");e.children[t].classList.contains("is-active")||e.children[t].classList.add("is-next")}#k(t){let e=document.querySelector(".test-progress-bar");e.children[t].classList.contains("is-next")&&(e.children[t].classList.remove("is-next"),e.children[t].classList.add("is-active"))}#w(){let t=!1,e=document.querySelectorAll(".radio-button-input");for(let s=0;s<e.length;++s)if(e[s].checked){t=!0;break}return t}#E(){let t=0,e=document.querySelectorAll(".radio-button-input");for(let s=0;s<e.length;++s)if(e[s].checked){t=parseInt(e[s].value,10);break}return t}#b(){let t=this.#I();if(this.userResult.length>0)for(let e=0;e<this.userResult.length;e++)this.userResult[e].questionId===t&&this.#O(this.userResult[e].chosenAnswerId)}#O(t){let e=document.querySelectorAll(".radio-button-input");for(let s=0;s<e.length;++s)parseInt(e[s].value)===t&&(e[s].checked=!0)}#I(){let t=document.querySelector(".question-title");return parseInt(t.firstElementChild.dataset.nodeId,10)}#L(){let t=document.querySelector(".question-title"),e=parseInt(t.dataset.nodeId,10);return--e,e}#q(t){if(0===this.userResult.length)this.userResult.push(t);else{let e=!0;for(let s=0;s<this.userResult.length;s++){let i=this.userResult[s];if(i.questionId===t.questionId){i.chosenAnswerId=t.chosenAnswerId,e=!1;break}}e&&this.userResult.push(t)}}#R(){let t=!0,e=document.querySelectorAll(".progress-bar-item");for(let s=0;s<e.length;++s)if(!e[s].classList.contains("is-active")){t=!1;break}return t}#y(t){clearInterval(this.timer.timerId),this.timer.timerId=0,this.#D(t)}#D(t){this.#z(),this.#H(),this.#P(),t?this.#V():this.#B()}#z(){let t=document.querySelector(".app-button.next[data-node-type='button-prev']"),e=document.querySelector(".omit-question");t.style.visibility="hidden",e.style.visibility="hidden"}#H(){let t=document.querySelectorAll(".radio-button-container");for(let e=0;e<t.length;++e)t[e].style.visibility="hidden"}#P(){document.querySelector(".question-title").firstElementChild.style.visibility="hidden"}#V(){document.querySelector(".snackbar.snackbar-question").classList.add("is-active")}#B(){document.querySelector(".snackbar.snackbar-timeout").classList.add("is-active")}}class l{constructor(){let t=s();this.id=t.id,this.score=t.score,this.total=t.total,this.data=[];let e=sessionStorage.getItem("madJunUser");e?(this.data=JSON.parse(e),document.querySelector(".user-answers-number").textContent=`${this.score}/${this.total}`,document.querySelector(".back-to-selection").addEventListener("click",this.#J.bind(this)),document.querySelector(".view-answers").addEventListener("click",this.#Q.bind(this))):location.href="#/"}#J(t){t.preventDefault(),sessionStorage.removeItem("madJunUser"),location.href="#/select?firstname="+this.data.name+"&lastname="+this.data.lastName+"&email="+this.data.email}#Q(t){t.preventDefault(),location.href="#/view?score="+this.score+"&total="+this.total+"&id="+this.id}}class r{constructor(){let t=s();this.id=parseInt(t.id,10),this.score=t.score,this.total=t.total,this.testResponse=null,this.answersResponse=null,this.user=[],isNaN(this.id)?location.href="#/":this.#r()}#r(){let t=new XMLHttpRequest;if(t.open("GET",`https://testologia.ru/get-quiz?id=${this.id}`,!1),t.send(),4===t.readyState&&200===t.status)try{this.testResponse=JSON.parse(t.responseText);let e=new XMLHttpRequest;e.open("GET",`https://testologia.ru/get-quiz-right?id=${this.id}`,!1),e.send(),4===e.readyState&&200===e.status&&(this.answersResponse=JSON.parse(e.responseText),this.#U(),document.querySelector(".back-to-result").addEventListener("click",this.#M.bind(this)))}catch(t){console.error(t),location.href="index.html"}else location.href="index.html"}#M(t){t.preventDefault(),location.href=`#/result?id=${this.id}&score=${this.score}&total=${this.total}`}#U(){document.querySelector(".view-test-name").textContent=this.testResponse.name;let t=sessionStorage.getItem("madJunUser");t?(this.user=JSON.parse(t),document.querySelector(".mad-jun-user-info").textContent=this.user.name+" "+this.user.lastName+", "+this.user.email,this.#X()):location.href="#/"}#X(){let t=document.querySelector(".answers-wrapper");for(let e=0;e<this.testResponse.questions.length;e++)this.#j(t,this.testResponse.questions[e],e+1,this.answersResponse[e])}#j(t,e,s,i){let n=document.createElement("div");n.classList.add("view-answer-item");let a=document.createElement("div"),l=document.createElement("h3");l.classList.add("h3","text-accent"),l.textContent=`Вопрос ${s}: `;let r=document.createElement("span");r.classList.add("text-primary"),r.textContent=e.question,l.appendChild(r),a.appendChild(l),n.appendChild(a);let o=document.createElement("div");o.classList.add("answers-list");for(let t=0;t<e.answers.length;++t){let s=document.createElement("div");s.classList.add("answer-option");let n=document.createElement("div");n.classList.add("answer-option-icon");let a=document.createElement("div");a.classList.add("text-size-medium"),a.textContent=e.answers[t].answer,e.answers[t].id===i?this.#G(e.id,i)&&(s.classList.add("valid"),n.classList.add("valid")):this.#Z(e.id,e.answers[t].id)&&(s.classList.add("invalid"),n.classList.add("invalid")),s.appendChild(n),s.appendChild(a),o.appendChild(s)}n.appendChild(o),t.appendChild(n)}#Z(t,e){let s=!1;for(let i=0;i<this.user.results.length;i++)if(this.user.results[i].questionId===t&&this.user.results[i].chosenAnswerId===e){s=!0;break}return s}#G(t,e){let s=!1;for(let i=0;i<this.user.results.length;i++)if(this.user.results[i].questionId===t&&this.user.results[i].chosenAnswerId===e){s=!0;break}return s}}const o=new class{constructor(){this.routes=[{route:"#/",pageTitle:"Itlogia Quiz",template:"./templates/index.html",load:()=>{}},{route:"#/register",pageTitle:"Sign Up",template:"./templates/register.html",load:()=>{new t("#form")}},{route:"#/select",pageTitle:"Test Select",template:"./templates/select.html",load:()=>{new n}},{route:"#/test",pageTitle:"Test",template:"./templates/test.html",load:()=>{new a}},{route:"#/result",pageTitle:"Result",template:"./templates/result.html",load:()=>{new l}},{route:"#/view",pageTitle:"Answers",template:"./templates/view.html",load:()=>{new r}}]}async openRoute(){const t=this.routes.find(t=>t.route===window.location.hash.split("?")[0]);t?(document.querySelector(".main-content-wrapper").innerHTML=await fetch(t.template).then(t=>t.text()),document.querySelector("#page-title").textContent=t.pageTitle,t.load()):location.href="#/"}};function d(){o.openRoute()}window.addEventListener("DOMContentLoaded",d),window.addEventListener("popstate",d)})();